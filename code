#!/usr/bin/env python3
# Advanced TCP Port Scanner
# Usage:
# python port_scanner.py <target> -s 1 -e 1024 -T 100

import socket
import threading
import argparse

lock = threading.Lock()

def scan_port(target, port, timeout):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(timeout)
        result = sock.connect_ex((target, port))

        if result == 0:
            try:
                service = socket.getservbyport(port)
            except:
                service = "unknown"
            with lock:
                print(f"[OPEN] Port {port} ({service})")

        sock.close()
    except:
        pass

def main():
    parser = argparse.ArgumentParser(description="TCP Port Scanner (Ethical Use Only)")
    parser.add_argument("target", help="Target IP or domain")
    parser.add_argument("-s", "--start", type=int, default=1, help="Start port")
    parser.add_argument("-e", "--end", type=int, default=1024, help="End port")
    parser.add_argument("-t", "--timeout", type=float, default=0.5, help="Timeout (seconds)")
    parser.add_argument("-T", "--threads", type=int, default=100, help="Max threads")

    args = parser.parse_args()

    print(f"\nTarget: {args.target}")
    print(f"Ports: {args.start}-{args.end}")
    print(f"Threads: {args.threads}\n")

    threads = []

    for port in range(args.start, args.end + 1):
        t = threading.Thread(target=scan_port, args=(args.target, port, args.timeout))
        threads.append(t)
        t.start()

        if len(threads) >= args.threads:
            for th in threads:
                th.join()
            threads = []

    for th in threads:
        th.join()

    print("\nScan finished.")

if __name__ == "__main__":
    main()